<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Clone Test</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f4f9; margin: 20px; }
        .container { max-width: 800px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); }
        h1 { color: #007bff; }
        .action-button { padding: 10px 20px; font-size: 16px; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 5px; margin-top: 15px; }
        .status { padding: 10px; margin-top: 15px; border-radius: 4px; font-weight: bold; }
        .status-running { background-color: #fff3cd; color: #856404; }
        .status-complete { background-color: #d4edda; color: #155724; }
        .status-error { background-color: #f8d7da; color: #721c24; white-space: pre-wrap; }
    </style>
</head>
<body>

<div class="container">
    <h1>GitHub Repository Clone Test</h1>
    <p>This script attempts to clone the repository named **`_`** to a new, unique repository named **`_1-[timestamp]`** under the **`Saadpie1`** account.</p>
    
    <button id="startButton" class="action-button" onclick="startCloneTest()">
        ðŸ”„ Start Clone Test
    </button>

    <div id="deployment-status" class="status status-running">
        Deployment Status: Ready.
    </div>
</div>

<script>
    // --- CONFIGURATION ---
    // Make sure this PAT is the LATEST one with the 'repo' scope.
    const GITHUB_PAT = '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';
    const REPO_OWNER = 'Saadpie1';
    
    // Source Repo to Clone From
    const TEMPLATE_REPO_OWNER = REPO_OWNER; 
    const TEMPLATE_REPO_NAME = '_'; // Your existing repo name
    
    // Target Repo Name (Dynamically generated)
    let NEW_REPO_NAME = ''; 

    const STATUS_ELEMENT = document.getElementById('deployment-status');
    const START_BUTTON = document.getElementById('startButton');

    // --- HELPER FUNCTIONS (Modified to show detailed errors) ---

    function updateStatus(message, isError = false) {
        STATUS_ELEMENT.innerHTML = isError 
            ? `Clone FAILED. <br> <strong>Details:</strong> ${message}` 
            : `Deployment Status: ${message}`;
        
        STATUS_ELEMENT.className = 'status ' + (isError ? 'status-error' : 'status-running');
        if (!isError && message.includes('SUCCESS')) {
            STATUS_ELEMENT.className = 'status status-complete';
        }
        console.log(`[STATUS] ${message}`);
    }

    function startCloneTest() {
        START_BUTTON.disabled = true;
        START_BUTTON.textContent = 'Cloning...';

        const timestamp = new Date().getTime();
        NEW_REPO_NAME = `_1-${timestamp}`; // Target repo will be unique

        cloneRepository();
    }


    // --- MAIN FUNCTION: Single API Call Test ---
    async function cloneRepository() {
        try {
            updateStatus(`1/1: Attempting to clone ${TEMPLATE_REPO_NAME} to ${NEW_REPO_NAME}...`);

            const createRepoUrl = `https://api.github.com/repos/${TEMPLATE_REPO_OWNER}/${TEMPLATE_REPO_NAME}/generate`;
            
            const createRepoResponse = await fetch(createRepoUrl, {
                method: 'POST',
                headers: {
                    'Accept': 'application/vnd.github.v3+json',
                    'Authorization': `Bearer ${GITHUB_PAT}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    owner: REPO_OWNER,
                    name: NEW_REPO_NAME,
                    description: 'Clone test via Gemini/GitHub API',
                    private: false,
                }),
            });

            if (!createRepoResponse.ok) {
                const errorBody = await createRepoResponse.json();
                
                let detailedMessage = `HTTP ${createRepoResponse.status}: ${createRepoResponse.statusText}`;
                
                if (errorBody.message) {
                    detailedMessage += `<br>API Message: ${errorBody.message}`;
                }
                if (errorBody.documentation_url) {
                    detailedMessage += `<br>Docs: <a href="${errorBody.documentation_url}" target="_blank">View GitHub Docs</a>`;
                }

                // Throw the detailed message to be caught below
                throw new Error(detailedMessage);
            }
            
            const repoData = await createRepoResponse.json();
            const repoFullName = repoData.full_name;
            const finalUrl = repoData.html_url;

            updateStatus(`SUCCESS! Repository cloned: ${repoFullName}. <br>View Repo: <a href="${finalUrl}" target="_blank">${finalUrl}</a>`, false);

        } catch (error) {
            updateStatus(`${error.message}`, true);

        } finally {
            START_BUTTON.disabled = false;
            START_BUTTON.textContent = 'ðŸ”„ Start Clone Test';
        }
    }

    window.onload = () => updateStatus("Ready for test.");
</script>
</body>
</html>
