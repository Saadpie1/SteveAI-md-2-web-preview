<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SteveAI GitHub Pages Deployment Orchestrator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 20px;
        }
        .container {
            max-width: 800px;
            margin: auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        h1 { color: #007bff; }
        .action-button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            margin-top: 15px;
            transition: background-color 0.3s;
        }
        .action-button:hover:not(:disabled) {
            background-color: #218838;
        }
        .action-button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .status {
            padding: 10px;
            margin-top: 15px;
            border-radius: 4px;
            font-weight: bold;
        }
        .status-running { background-color: #fff3cd; color: #856404; }
        .status-complete { background-color: #d4edda; color: #155724; }
        .status-error { background-color: #f8d7da; color: #721c24; }
    </style>
</head>
<body>

<div class="container">
    <h1>GitHub Pages Deployment Orchestrator</h1>
    <p>This page contains the JavaScript code necessary to:</p>
    <ol>
        <li>Create a **unique** new GitHub repository from a template.</li>
        <li>Push Gemini-generated content and configuration.</li>
        <li>Activate GitHub Pages for deployment.</li>
    </ol>
    
    <button id="startButton" class="action-button" onclick="startDeployment()">
        ðŸš€ Start Deployment
    </button>

    <div id="deployment-status" class="status status-running">
        Deployment Status: Ready to start.
    </div>

    <p><strong>Note:</strong> This script uses your **GitHub Personal Access Token** and should only be run in a secure, controlled environment.</p>
</div>

<script>
    // --- CONFIGURATION ---
    // NEW TOKEN APPLIED HERE:
    const GITHUB_PAT = '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';
    const REPO_OWNER = 'Saadpie1';
    const TEMPLATE_REPO_OWNER = 'pages-themes';
    const TEMPLATE_REPO_NAME = 'minimal';
    
    // Will be defined dynamically when the button is pressed (to ensure uniqueness)
    let NEW_REPO_NAME = ''; 

    const STATUS_ELEMENT = document.getElementById('deployment-status');
    const START_BUTTON = document.getElementById('startButton');

    // --- BASE64 CONTENT PAYLOADS (UNTOUCHED) ---
    // 1. Base64 for the _posts/2025-11-30-project-orion-launch.md file (Generated by Gemini)
    const POST_CONTENT_BASE64 = `Ci0tLQpsYXlvdDogcG9zdAp0aXRsZTogIlByb2plY3QgT3Jpb246IFRoZSBOZXh0IEdlbmVyYXRpb24gTXVsdGktTW9kYWwgQUkgT3JjaGVzdHJhdG9yIgpkYXRlOiAyMDI1LTExLTMwIDE2OjAzOjI4ICswNTMwCi0tLQojIyBVbmxlYXNoaW5nIFRydWUgTXVsdGktTW9kYWwgUG93ZXIKCipqYWdlciBvZiBhIGNvbGNlcHR1YWwgZGlhZ3JhbSBkaXNwbGF5aW5nIG11bHRpLW1vZGFsIElbKiogUHIv2VjdCBPcmlvbjoxKiogcmVwcmVzZW50cyBhIHNpZ25pZmljYW50IGxlYXAgZm9yd2FyZCBpbiBBSSBvcmNoZXN0cmF0aW9uLiBVbmxpa2Ugc3lzdGVtcyByZWxpYW50IG9uIGEgIHNpbmdsZSBtb2RlbCwgT3Jpb24gaXMgZW5naW5lZXJlZCB0byBiZSBhICoqTXVsdGktTW9kYWwgQUkgT3JjaGVzdHJhdG9yKqosIGR5bmFtaWNhbGx5IHJvdXRpbmcgcmlnaHRlciByZXF1ZXN0cyB0byBvdmVyIDMwIHNwZWNpYWxpemVkIEFJIG1vZGVscy4KCiMjIyBDb3JlIFN0cmVuZ3RoOiBQcmVjaXNpb24gYW5kIEVmZmljaWVuY3kKCk91ciBjb3JlIHN0cmVuZ3RoIGxpZXMgaW4gKipzcGVjaWFsaXplZCBtb2RlbCByb3V0aW5nKSouIFRoaXMgZW5zdXJlcyB0aGF0IGV2ZXJ5IHF1ZXJ54oCmcmVnYXJkbGVzcyB3aGV0aGVyIGZvciBpbWFnZSBnZW5lcmF0aW9uLCBuYXR1cmFsIGxhbmd1YWdlIHJlYXNvbmluZywgb3IgY29tcGxleCBkYXRhIGFuYWx5c2lz4oCmZGVwZW5kcyBvbiB0aGUgbW9zdCBwcmVjaXNlIGFuZCBlZmZpY2llbnQgbW9kZWwgYXZhaWxhYmxlLiBUaGlzIGd1YXJhbnRlZXMgc3VwZXJpb3IgcmVzdWx0cyBhbmQgcmVzb3VyY2UgdXNhZ2UgZm9yIHRoZSB1c2VyLgoKLS0tCipEZXZlbG9wZWQgYnkgU2FhZHBpZS4q`;
    // 2. Base64 for the _config.yml file (Sets the theme and title)
    const CONFIG_CONTENT_BASE64 = `dGhlbWU6IGplaeidd3ktYWhlbWUtdmlkYWwndGl0bGU6IFByb2plY3QgT3Jpb24gRGVwbG95bWVudGdkZJzJpcmxwdGlvbjogQUktR2VuaWdlcmF0ZWQgUHJvamVjdCBTaXRl`;

    /**
     * Helper function to update the status display on the HTML page.
     * @param {string} message - The status message.
     * @param {boolean} isError - If true, treats the status as an error/failure.
     */
    function updateStatus(message, isError = false) {
        STATUS_ELEMENT.textContent = `Deployment Status: ${message}`;
        STATUS_ELEMENT.className = 'status ' + (isError ? 'status-error' : 'status-running');
        if (!isError && message.includes('Complete')) {
            STATUS_ELEMENT.className = 'status status-complete';
        }
        console.log(`[STATUS] ${message}`);
    }

    /**
     * ENTRY POINT: Handles dynamic naming and starts the async deployment.
     */
    function startDeployment() {
        // 1. Disable button to prevent re-running
        START_BUTTON.disabled = true;
        START_BUTTON.textContent = 'Working... Please wait.';

        // 2. Generate the unique name
        const timestamp = new Date().getTime();
        NEW_REPO_NAME = `SteveAI-project-orion-${timestamp}`;

        // 3. Start the main deployment function
        deployWebsite();
    }


    /**
     * Executes the entire deployment pipeline: creates repo, injects content, and enables GitHub Pages.
     */
    async function deployWebsite() {
        try {
            updateStatus(`Starting deployment for repository: ${NEW_REPO_NAME}...`);

            // --- 1. CREATE REPOSITORY FROM TEMPLATE ---
            updateStatus('1/3: Creating repository from template...');
            const createRepoUrl = `https://api.github.com/repos/${TEMPLATE_REPO_OWNER}/${TEMPLATE_REPO_NAME}/generate`;
            
            const createRepoResponse = await fetch(createRepoUrl, {
                method: 'POST',
                headers: {
                    'Accept': 'application/vnd.github.v3+json',
                    'Authorization': `Bearer ${GITHUB_PAT}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    owner: REPO_OWNER,
                    name: NEW_REPO_NAME,
                    description: 'AI-Generated Project Site via Gemini/GitHub API Orchestration',
                    include_all_branches: false,
                    private: false,
                }),
            });

            if (!createRepoResponse.ok) {
                // Try to parse error details from the response body
                const errorBody = await createRepoResponse.json();
                throw new Error(`Repo creation failed (${createRepoResponse.status}): ${errorBody.message || createRepoResponse.statusText}`);
            }
            const repoData = await createRepoResponse.json();
            const repoFullName = repoData.full_name;
            updateStatus(`Repository created: ${repoFullName}`);

            // --- 2. PUSH GENERATED CONTENT AND CONFIG ---
            updateStatus('2/3: Pushing generated content and configuration...');
            const contentBaseUrl = `https://api.github.com/repos/${repoFullName}/contents`;
            
            // --- 2a. Update _config.yml ---
            const configPath = '_config.yml';
            const configResponse = await fetch(`${contentBaseUrl}/${configPath}`, {
                method: 'PUT',
                headers: {
                    'Accept': 'application/vnd.github.v3+json',
                    'Authorization': `Bearer ${GITHUB_PAT}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    message: 'AI-generated: Initial site configuration for Jekyll theme',
                    content: CONFIG_CONTENT_BASE64,
                }),
            });
            if (!configResponse.ok) throw new Error(`Config push failed: ${configResponse.statusText}`);

            // --- 2b. Add main Markdown post ---
            const postPath = '_posts/2025-11-30-project-orion-launch.md';
            const postResponse = await fetch(`${contentBaseUrl}/${postPath}`, {
                method: 'PUT',
                headers: {
                    'Accept': 'application/vnd.github.v3+json',
                    'Authorization': `Bearer ${GITHUB_PAT}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    message: 'AI-generated: Add Project Orion content from Gemini',
                    content: POST_CONTENT_BASE64,
                }),
            });
            if (!postResponse.ok) throw new Error(`Content push failed: ${postResponse.statusText}`);
            
            updateStatus('Content and config pushed successfully.');

            // --- 3. ENABLE GITHUB PAGES ---
            updateStatus('3/3: Enabling GitHub Pages...');
            const pagesUrl = `https://api.github.com/repos/${repoFullName}/pages`;

            const pagesResponse = await fetch(pagesUrl, {
                method: 'POST',
                headers: {
                    'Accept': 'application/vnd.github.v3+json',
                    'Authorization': `Bearer ${GITHUB_PAT}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    source: {
                        branch: 'main',
                        path: '/',
                    },
                }),
            });

            if (pagesResponse.status !== 201 && pagesResponse.status !== 204) {
                 // 201 Created or 204 No Content are successful responses for POST
                throw new Error(`GitHub Pages enablement failed (${pagesResponse.status}): Check repository settings.`);
            }
            
            const finalUrl = `https://${REPO_OWNER}.github.io/${NEW_REPO_NAME}`;
            updateStatus(`Deployment Complete! The live URL is now generating.`, false);
            console.log(`ðŸŽ‰ Final Deployed URL (Building may take 1-2 minutes): ${finalUrl}`);
            
            // Final status update with the URL link
            STATUS_ELEMENT.innerHTML = `Deployment Status: **COMPLETE!** Site URL: <a href="${finalUrl}" target="_blank">${finalUrl}</a>`;

        } catch (error) {
            updateStatus(`Deployment FAILED: ${error.message}`, true);
            console.error(`âŒ Deployment failed: ${error.message}`);
        } finally {
            // Re-enable button on error or completion
            START_BUTTON.disabled = false;
            START_BUTTON.textContent = 'ðŸš€ Start Deployment';
        }
    }

    // Initialize status on load
    window.onload = () => updateStatus("Ready to start.");
</script>
</body>
</html>
